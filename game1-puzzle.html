<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ‹¼åœ–éŠæˆ²</title>
  <style>
    body { font-family: "Noto Sans TC", sans-serif; text-align:center; padding:20px; }
    #puzzle-container { 
      display: grid; 
      grid-template-columns: repeat(3, 100px); 
      gap: 2px; 
      margin: 20px auto; 
      justify-content: center;
    }
    .piece { 
      width: 100px; 
      height: 100px; 
      background-size: 300px 300px; 
      cursor: grab; 
      border:1px solid #ccc; 
    }
    .green-btn { position: absolute; top: 10px; right: 10px; padding:10px 20px; background-color:green; color:white; border-radius:20px; text-decoration:none; }
    #quiz-container button { margin:5px; padding:10px 20px; border-radius:10px; cursor:pointer; }
  </style>
</head>
<body>
  <a href="index.html" class="green-btn">è¿”å›äº’å‹•éŠæˆ²</a>
  <h2>æ‹¼åœ–éŠæˆ²</h2>
  <button id="startBtn">é–‹å§‹éŠç©</button>
  <div id="puzzle-container"></div>

  <!-- å•ç­”å€ -->
  <div id="quiz-container" style="display:none; margin-top:20px;">
    <p id="question"></p>
    <button class="option-btn" data-answer="A"></button>
    <button class="option-btn" data-answer="B"></button>
    <button class="option-btn" data-answer="C"></button>
    <button class="option-btn" data-answer="D"></button>
    <p id="result" style="margin-top:10px; font-weight:bold;"></p>
  </div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const container = document.getElementById('puzzle-container');
    const quizContainer = document.getElementById('quiz-container');
    const questionEl = document.getElementById('question');
    const resultEl = document.getElementById('result');

    const question = "è«‹å•é€™å¼µæ‹¼åœ–åœ–ç‰‡ä»£è¡¨ä»€éº¼ï¼Ÿ";
    const options = {A:"é¸é …1", B:"é¸é …2", C:"é¸é …3", D:"é¸é …4"};
    const correctAnswer = "B";

    let draggedIndex = null;

    startBtn.addEventListener('click', () => {
      container.innerHTML = '';
      quizContainer.style.display = 'none';
      resultEl.textContent = '';

      let fullImage = 'img/puzzle.jpg';
      let pieces = [];

      // å»ºç«‹æ‹¼åœ–å¡Š
      for(let i=0;i<9;i++){
        const div = document.createElement('div');
        div.className = 'piece';
        div.style.backgroundImage = `url(${fullImage})`;
        div.style.backgroundPosition = `${-100*(i%3)}px ${-100*Math.floor(i/3)}px`;
        div.dataset.correctIndex = i; // è¨˜éŒ„æ­£ç¢ºä½ç½®
        pieces.push(div);
      }

      // æ‰“äº‚
      pieces.sort(()=> Math.random()-0.5);
      pieces.forEach((div, idx)=>{
        div.dataset.currentIndex = idx; // è¨˜éŒ„ç›®å‰ä½ç½®
        container.appendChild(div);

        // æ‹–æ›³äº‹ä»¶
        div.draggable = true;
        div.addEventListener('dragstart', e => {
          draggedIndex = idx;
        });
        div.addEventListener('dragover', e => e.preventDefault());
        div.addEventListener('drop', e => {
          // äº¤æ›ä½ç½®
          const targetIndex = idx;
          if(draggedIndex !== null){
            const draggedDiv = container.children[draggedIndex];
            const targetDiv = container.children[targetIndex];

            container.insertBefore(draggedDiv, targetDiv);
            container.insertBefore(targetDiv, container.children[draggedIndex]);

            // æ›´æ–° currentIndex
            Array.from(container.children).forEach((child, i)=> child.dataset.currentIndex = i);
            checkPuzzleComplete();
          }
        });
      });

      function checkPuzzleComplete(){
        let complete = true;
        Array.from(container.children).forEach(div=>{
          if(div.dataset.currentIndex != div.dataset.correctIndex){
            complete = false;
          }
        });
        if(complete){
          showQuiz();
        }
      }

      function showQuiz(){
        questionEl.textContent = question;
        document.querySelectorAll('.option-btn').forEach(btn=>{
          btn.textContent = options[btn.dataset.answer];
          btn.onclick = function(){
            if(this.dataset.answer === correctAnswer){
              resultEl.textContent = "ç­”å°äº†ï¼é€šé—œæˆåŠŸğŸ‰";
            } else {
              resultEl.textContent = "ç­”éŒ¯äº†ï¼Œå†è©¦ä¸€æ¬¡âŒ";
            }
          }
        });
        quizContainer.style.display = 'block';
      }
    });
  </script>
</body>
</html>
