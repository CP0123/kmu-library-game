<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>拼圖遊戲</title>
  <style>
    body { text-align: center; font-family: sans-serif; }
    #puzzle-container { display: grid; grid-template-columns: repeat(3, 100px); grid-gap: 2px; width: 306px; height: 306px; margin: 20px auto; border: 2px solid #000; }
    #source-container { position: relative; width: 100%; height: 320px; border: 1px dashed #ccc; margin: 20px auto; }
    .piece { width: 100px; height: 100px; background-size: 300px 300px; border: 2px solid red; cursor: grab; position: absolute; }
    #countdown { font-size: 20px; margin-top: 10px; }
    #description { font-size: 16px; margin-top: 5px; }
  </style>
</head>
<body>
  <h2>拼圖遊戲</h2>
  <button id="startBtn">開始遊玩</button>
  <div id="full-image-container"></div>
  <div id="countdown"></div>
  <div id="description"></div>

  <div id="puzzle-container"></div>
  <div id="source-container"></div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const fullContainer = document.getElementById('full-image-container');
    const countdownEl = document.getElementById('countdown');
    const descEl = document.getElementById('description');
    const puzzleContainer = document.getElementById('puzzle-container');
    const sourceContainer = document.getElementById('source-container');

    const fullImage = 'img/puzzle.jpg'; // 請放置你的拼圖圖片
    let draggedPiece = null;
    const pieces = [];

    startBtn.addEventListener('click', () => {
      startBtn.disabled = true;
      puzzleContainer.innerHTML = '';
      sourceContainer.innerHTML = '';
      fullContainer.innerHTML = `<img src="${fullImage}" style="width:300px;height:300px;">`;
      descEl.innerText = '請於5秒內記憶此圖片';
      let timeLeft = 5;
      countdownEl.innerText = `倒數: ${timeLeft}s`;

      const timer = setInterval(() => {
        timeLeft--;
        countdownEl.innerText = `倒數: ${timeLeft}s`;
        if(timeLeft <= 0){
          clearInterval(timer);
          fullContainer.innerHTML = '';
          countdownEl.innerText = '';
          descEl.innerText = '';
          initPuzzle();
        }
      }, 1000);
    });

    function initPuzzle(){
      // 建立9塊拼圖
      for(let i=0;i<9;i++){
        const div = document.createElement('div');
        div.className = 'piece';
        div.style.backgroundImage = `url(${fullImage})`;
        div.style.backgroundPosition = `${-100*(i%3)}px ${-100*Math.floor(i/3)}px`;
        div.dataset.correctIndex = i;
        // 隨機散落位置
        div.style.left = Math.random()*(sourceContainer.offsetWidth-100) + 'px';
        div.style.top = Math.random()*(sourceContainer.offsetHeight-100) + 'px';
        div.draggable = true;

        div.addEventListener('dragstart', e => {
          if(div.classList.contains('correct')) e.preventDefault();
          draggedPiece = div;
        });

        pieces.push(div);
        sourceContainer.appendChild(div);
      }
    }

    // 目標容器 drop
    puzzleContainer.addEventListener('dragover', e => e.preventDefault());
    puzzleContainer.addEventListener('drop', e => {
      if(!draggedPiece) return;
      const rect = puzzleContainer.getBoundingClientRect();
      const x = Math.floor((e.clientX - rect.left) / 100);
      const y = Math.floor((e.clientY - rect.top) / 100);
      const targetIndex = y*3 + x;

      if(targetIndex === parseInt(draggedPiece.dataset.correctIndex)){
        draggedPiece.classList.add('correct');
        draggedPiece.style.border = 'none';
        draggedPiece.style.position = 'relative';
        draggedPiece.style.left = '0';
        draggedPiece.style.top = '0';
        puzzleContainer.appendChild(draggedPiece);
      }
      draggedPiece = null;
    });
  </script>
</body>
</html>
