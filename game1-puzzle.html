<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>拼圖遊戲</title>
  <style>
    body { font-family: "Noto Sans TC", sans-serif; text-align:center; padding:20px; }
    #puzzle-container { 
      display: grid; 
      grid-template-columns: repeat(3, 100px); 
      gap: 2px; 
      margin: 20px auto; 
      justify-content: center;
    }
    .piece { 
      width: 100px; 
      height: 100px; 
      background-size: 300px 300px; 
      cursor: grab; 
      border:1px solid #ccc; 
    }
    .green-btn { position: absolute; top: 10px; right: 10px; padding:10px 20px; background-color:green; color:white; border-radius:20px; text-decoration:none; }
    #quiz-container button { margin:5px; padding:10px 20px; border-radius:10px; cursor:pointer; }
  </style>
</head>
<body>
  <a href="index.html" class="green-btn">返回互動遊戲</a>
  <h2>拼圖遊戲</h2>
  <button id="startBtn">開始遊玩</button>
  <div id="puzzle-container"></div>

  <!-- 問答區 -->
  <div id="quiz-container" style="display:none; margin-top:20px;">
    <p id="question"></p>
    <button class="option-btn" data-answer="A"></button>
    <button class="option-btn" data-answer="B"></button>
    <button class="option-btn" data-answer="C"></button>
    <button class="option-btn" data-answer="D"></button>
    <p id="result" style="margin-top:10px; font-weight:bold;"></p>
  </div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const container = document.getElementById('puzzle-container');
    const quizContainer = document.getElementById('quiz-container');
    const questionEl = document.getElementById('question');
    const resultEl = document.getElementById('result');

    const question = "請問這張拼圖圖片代表什麼？";
    const options = {A:"選項1", B:"選項2", C:"選項3", D:"選項4"};
    const correctAnswer = "B";

    let draggedIndex = null;

    startBtn.addEventListener('click', () => {
      container.innerHTML = '';
      quizContainer.style.display = 'none';
      resultEl.textContent = '';

      let fullImage = 'img/puzzle.jpg';
      let pieces = [];

      // 建立拼圖塊
      for(let i=0;i<9;i++){
        const div = document.createElement('div');
        div.className = 'piece';
        div.style.backgroundImage = `url(${fullImage})`;
        div.style.backgroundPosition = `${-100*(i%3)}px ${-100*Math.floor(i/3)}px`;
        div.dataset.correctIndex = i; // 記錄正確位置
        pieces.push(div);
      }

      // 打亂
      pieces.sort(()=> Math.random()-0.5);
      pieces.forEach((div, idx)=>{
        div.dataset.currentIndex = idx; // 記錄目前位置
        container.appendChild(div);

        // 拖曳事件
        div.draggable = true;
        div.addEventListener('dragstart', e => {
          draggedIndex = idx;
        });
        div.addEventListener('dragover', e => e.preventDefault());
        div.addEventListener('drop', e => {
          // 交換位置
          const targetIndex = idx;
          if(draggedIndex !== null){
            const draggedDiv = container.children[draggedIndex];
            const targetDiv = container.children[targetIndex];

            container.insertBefore(draggedDiv, targetDiv);
            container.insertBefore(targetDiv, container.children[draggedIndex]);

            // 更新 currentIndex
            Array.from(container.children).forEach((child, i)=> child.dataset.currentIndex = i);
            checkPuzzleComplete();
          }
        });
      });

      function checkPuzzleComplete(){
        let complete = true;
        Array.from(container.children).forEach(div=>{
          if(div.dataset.currentIndex != div.dataset.correctIndex){
            complete = false;
          }
        });
        if(complete){
          showQuiz();
        }
      }

      function showQuiz(){
        questionEl.textContent = question;
        document.querySelectorAll('.option-btn').forEach(btn=>{
          btn.textContent = options[btn.dataset.answer];
          btn.onclick = function(){
            if(this.dataset.answer === correctAnswer){
              resultEl.textContent = "答對了！通關成功🎉";
            } else {
              resultEl.textContent = "答錯了，再試一次❌";
            }
          }
        });
        quizContainer.style.display = 'block';
      }
    });
  </script>
</body>
</html>
